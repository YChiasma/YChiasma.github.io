<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Local Journal</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px; }
    textarea { width: 100%; height: 120px; margin-bottom: 10px; }
    button { padding: 8px 16px; margin: 5px 5px 15px 0; cursor: pointer; }
    .entry { background: #f4f4f4; padding: 12px; margin-bottom: 10px; border-radius: 6px; position: relative; }
    .timestamp { font-size: 0.9em; color: #555; margin-bottom: 5px; }
    .delete-btn { background: #d9534f; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; position: absolute; top: 10px; right: 10px; }
  </style>
</head>
<body>
  <h1>My Journal</h1>
  <textarea id="journalInput" placeholder="Write your thoughts..."></textarea><br>
  <button onclick="saveEntry()">Save Entry</button>
  <button onclick="exportEntries()">Export Entries</button>
  <input type="file" id="importFile" accept=".txt" onchange="importEntries(event)" />

  <h2>Previous Entries</h2>
  <div id="entries"></div>

  <script>
    // Load saved entries from localStorage
    function loadEntries() {
      let entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
      let container = document.getElementById('entries');
      container.innerHTML = '';
      entries.slice().reverse().forEach((entry, index) => {
        let div = document.createElement('div');
        div.className = 'entry';
        let realIndex = entries.length - 1 - index; // correct index in array
        div.innerHTML = `
          <div class="timestamp">${entry.time}</div>
          <div>${entry.text}</div>
          <button class="delete-btn" onclick="deleteEntry(${realIndex})">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    // Save a new entry
    function saveEntry() {
      let text = document.getElementById('journalInput').value.trim();
      if (!text) return;
      let entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
      let timestamp = new Date().toLocaleString();
      entries.push({ time: timestamp, text: text });
      localStorage.setItem('journalEntries', JSON.stringify(entries));
      document.getElementById('journalInput').value = '';
      loadEntries();
    }

    // Delete an entry by index with confirmation
    function deleteEntry(index) {
      if (!confirm('Are you sure you want to delete this entry?')) return;
      let entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
      entries.splice(index, 1);
      localStorage.setItem('journalEntries', JSON.stringify(entries));
      loadEntries();
    }

    // Export entries as a .txt file
    function exportEntries() {
      let entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
      if (entries.length === 0) {
        alert('No entries to export.');
        return;
      }
      let content = entries.map(e => `${e.time}\n${e.text}\n\n`).join('');
      let blob = new Blob([content], { type: 'text/plain' });
      let url = URL.createObjectURL(blob);
      let a = document.createElement('a');
      a.href = url;
      a.download = 'journal_entries.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Import entries from a .txt file with date detection
    function importEntries(event) {
      let file = event.target.files[0];
      if (!file) return;

      let reader = new FileReader();
      reader.onload = function(e) {
        let content = e.target.result.trim();
        if (!content) return;

        let lines = content.split(/\r?\n/);
        let entries = [];
        let currentEntry = null;

        // Regex to detect common date formats (MM/DD/YYYY, YYYY-MM-DD, locale strings)
        let dateRegex = /(\d{1,4}[\/\-]\d{1,2}[\/\-]\d{1,4}|\w{3,9}\s+\d{1,2},\s*\d{4}|\d{1,2}:\d{2}:\d{2})/;

        lines.forEach(line => {
          if (dateRegex.test(line)) {
            if (currentEntry) {
              entries.push(currentEntry);
            }
            currentEntry = { time: line.trim(), text: '' };
          } else if (currentEntry) {
            currentEntry.text += (currentEntry.text ? "\n" : "") + line.trim();
          }
        });

        if (currentEntry) {
          entries.push(currentEntry);
        }

        if (entries.length === 0) {
          alert('No valid entries found in file.');
          return;
        }

        if (!confirm('This will overwrite your current journal entries. Continue?')) return;

        localStorage.setItem('journalEntries', JSON.stringify(entries));
        loadEntries();
      };
      reader.readAsText(file);
    }

    // Load entries when page loads
    window.onload = loadEntries;
  </script>
</body>
</html>
